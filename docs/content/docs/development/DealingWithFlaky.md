---
title: Работа с флакующими тестами
type: docs
---

# Работа с флакующими тестами

## Что не надо делать

- Игнорировать тесты в TeamCity. Вы просто "подложите свинью" своим коллегам в будущем.
- Помечать тест как `@Ignore`. Есть специальная аннотация [`@Flaky`]({{< ref "/docs/test/FlakyTests.md" >}}).

## Убедись что тест действительно флакует

1. Посмотри в чаты [#android-dev](http://links.k.avito.ru/slackandroiddev) или 
   [#android-autotesting](http://links.k.avito.ru/slackandroidautotesting). Вероятно, проблема уже известна.
1. Посмотри [статистику стабильности теста]({{< ref "#где-посмотреть-статистику-по-стабильности-тестов" >}})
1. Для проверки запускай тест в несколько прогонов в [динамической конфигурации]({{< ref "/docs/test/Run.md#custom-run" >}}).

## Отлаживай в IDE

В Android Studio должен из коробки работать debug на конкретном тесте.

https://developer.android.com/studio/debug

### Layout Inspector

<br> *Layout inspector использует adb поэтому мы не можем получить состояние экрана в дебажном запуске.* \
<br> __Как получить экран во время прогона теста?__
1. Добавить в нужное место `Thread.sleep()`.
2. Запустить тест без дебага и дождаться пока исполнение попадет в `Thread.sleep()`
3. Задампить состояние экрана через Layout Inspector

## Если не удалось найти причину

1. Обратись к автору тесту или юниту, который за него отвечает.
1. Если тест уже чинят, то можно дождаться фикса.
1. Если проблема новая, то договоритесь о том, кто поставить аннотацию `@Flaky` на тест.
1. В аннотации обязательно укажите причину, а лучше задачу, в которой тест будет исправлен.
1. Запушьте изменения

## Если проблема никак не решается

1. [Обратись за помощью]({{<ref "/docs/Contacts.md" >}})
1. Приложи сылку на репорт.
1. Помогут также логи с ошибками.

## Где посмотреть статистику по стабильности тестов?

- [Общая статистика по тестам (internal)](http://links.k.avito.ru/FR)
- [История нестабильности теста (internal)](http://links.k.avito.ru/5W)

Обратите внимание на параметры фильтрации.

## Когда убирать аннотацию `@Flaky`

Если вы внесли изменения, которые чинят исходную причину флакования теста, то в том же PR 
необходимо убрать аннотацию с починенных тестов.