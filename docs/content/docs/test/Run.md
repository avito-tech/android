---
title: Запуск тестов
type: docs
---

# Запуск тестов

{{<avito page>}}

## Автоматически запускаемые тесты

### Тесты на PR

При создании Pull Request'а ваша ветка ребейзится на целевую ветку и автоматически запускается
[`fastCheck`](http://links.k.avito.ru/PV), объявленный в `avito/build.gradle`:
- Юнит тесты
- Инструментальные тесты (кроме помеченных аннотацией [`@Flaky`]({{< ref "/docs/test/FlakyAnnotation.md" >}})):
  - Перформанс
  - Компонентные
  - [Скриншотные]({{< ref "/docs/test/ScreenshotTesting.md" >}})
  - Интеграционные (`@IntegrationTest`)
- [Android Lint]({{< ref "/docs/checks/AndroidLint.md" >}})

### Проверки develop'а

Раз в 3 часа при наличии изменений в develop-ветке на ней запускается [`fullCheck`](http://links.k.avito.ru/5u),
объявленный в `avito/build.gradle` и содержищий следующие проверки:
- Юнит тесты
- Инструментальные тесты:
  - Компонентные
  - E2E
  - [Скриншотные]({{< ref "/docs/test/ScreenshotTesting.md" >}})
  - Интеграционные (`@IntegrationTest`)
- [Android Lint]({{< ref "/docs/checks/AndroidLint.md" >}})

{{< hint warning >}}
Тесты, почеменные как [`@Flaky`]({{< ref "/docs/test/FlakyAnnotation.md" >}}) запускаются, но на результат прогона не влияют.
{{< /hint >}}

### Регресс

Регресс [автоматически запускается](http://links.k.avito.ru/OjE) каждый день таким образом, чтобы к началу рабочего дня
уже был как минимум один прогон, а к началу регресса - несколько прогонов для выявления флаки тестов. За регресс
отвечает конфигурация `release`, объявленая в `avito/build.gradle`. Результаты прогонов агрегируются в отчет по коммиту,
с которого был запущен регресс, и упавшие тесты рассылаются ответственным юнитам в соответствующие чаты в Slack. Имя
пакета теста отображается на имя канала в словаре `unitToChannelMap` [здесь](http://links.k.avito.ru/RM) (ссылка на
внутренний ресурс).

Регресс включает в себя:
- Юнит тесты
- Инструментальные тесты:
  - Компонентные
  - E2E
  - [Скриншотные]({{< ref "/docs/test/ScreenshotTesting.md" >}})
  - Интеграционные (`@IntegrationTest`)
- [Android Lint]({{< ref "/docs/checks/AndroidLint.md" >}})

{{< hint danger >}}
Пожалуйста, не запускайте эту конфигурацию руками. Это приведет к рассылке уведомлений в каналы юнитов в Slack, что зря
потревожит ответственных. Можно прогнать аналогичный набор тестов и [другим образом](#all-tests).
{{< /hint >}}

## Запуск тестов вручную

### В IDE

Обрати внимание на [кастомные конфигурации]({{< ref "/docs/ide/Configurations.md" >}})

#### Запуск Robolectric тестов

Просто запускаем стрелками Run напротив имени тестового класса или метода.

#### Запуск Instrumentation тестов

Аналогично Robolectric тестам - просто запускаем тест средствами Android Studio.

### Запуск тестов в CI с кастомными параметрами {#custom-run}

1. Перейдите на [конфигурацию `instrumentationDynamic`](http://links.k.avito.ru/tmctAvitoAndroidInstrumentationDynamic)
2. Нажмите `Run` ![](https://user-images.githubusercontent.com/8560287/89888381-86d8de80-dbd8-11ea-8369-55b517b07b39.png)
3. В появившемся окне настройте окружение для запуска
    1. Во вкладке `Changes`
    ![](https://user-images.githubusercontent.com/8560287/89891426-b6d6b080-dbdd-11ea-8de1-4b68d747d05e.png)
        - `Build branch` - ветка для запуска тестов
    1. Во вкладке `Parameters`
    ![](https://user-images.githubusercontent.com/8560287/89917357-607b6900-dc01-11ea-9241-e9192af6af06.png)
        1. `Test URL` - опциональный. API URL, в который ходят тесты
        2. `env.DYNAMIC_FILTER` - опциональный. Фильтр по типам тестов
            - `ui` -- компонентные, E2E, скриншотные, интеграционные тесты
            - `uiNoE2E` -- как `ui`, но без E2E тестов
            - `regressionNoE2E` -- `uiNoE2E` + ручные тесты
            - `regression` -- `ui` + ручные тесты
            - `performanceNoE2E` -- только компонентные перформанс тесты
            - `performance` -- только функциональные performance тесты
        3. `Package prefix` - опциональный. Фильтр по имени теста. `package.ClassName.methodName`
            - `package` - отфильтровать по пакету
            - `package.ClassName` - отфильтровать по классу
            - `package.ClassName.methodName` - отфильтровать по методу в классе
        4. `Retry count` - обязательный. Кол-во запусков. Полезно для [отладки нестабильных тестов]({{< ref "/docs/test/TroubleshootingUI.md" >}})
        5. `[22, 23, 24, 28] Api` - должен быть выбран минимум 1. На каких API запускать тесты

### Как прогнать полный набор тестов (как на регрессе) {#all-tests}

Для запуска набора тестов, аналогичного регрессу (но без рассылки репортов в юниты), воспользуйтесь TeamCity
конфигурацией [fullCheck](http://links.k.avito.ru/5u). В настройках запуска можно задать следующие параметры:
- Ветку для запуска (*Changes -> Build branch*)
- API URL, в который ходят тесты (*Parameters -> Test URL*)

### Локальный запуск тестов в инфре

Сейчас в разработке находится механизм локального запуска инструментальных тестов на эмуляторах в кубе. Уже работает для
тестового приложения в инфре. Подробности [здесь]({{< ref "/docs/test/Runner.md" >}}).
