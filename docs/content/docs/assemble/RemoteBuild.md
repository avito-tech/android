---
title: Mirakle
type: docs
---

# Remote build

{{<avito page>}}

–î–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–ª–∞–≥–∏–Ω [Mirakle](https://github.com/Instamotor-Labs/mirakle).\
–û–Ω –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω—É—é –º–∞—à–∏–Ω—É –≤ –¥–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–µ. 
–ö–æ–º–ø—å—é—Ç–µ—Ä –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –Ω–µ —Ç–∞–∫ –Ω–∞–≥—Ä—É–∂–µ–Ω, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º.

{{<mermaid>}}
sequenceDiagram
    üíª->>+Builder: –î–µ—Ä–∂–∏ –ø—Ä–æ–µ–∫—Ç (rsync)
    Note right of Builder: –°–æ–±–∏—Ä–∞—é
    Builder-->>üíª: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    Builder->>-üíª: –ó–∞–∫–æ–Ω—á–∏–ª
{{</mermaid>}}


## –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑?

- –£—Å—Ç–∞–Ω–æ–≤–∏ rsync
- –ü–æ—Å–º–æ—Ç—Ä–∏ –∫–∞–∫–æ–π host –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ `mirakle.py`
- –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω—ã –ø–æ ssh (—Å VPN):

```sh
ssh [<username>@]<mirakle host>
```

–ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞:
    - –ü—Ä–æ–≤–µ—Ä—å –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–ª—é—á ([checking for existing SSH keys](https://help.github.com/en/enterprise/2.15/user/articles/checking-for-existing-ssh-keys)) 
    –∏–ª–∏ [—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π](https://confluence.atlassian.com/bitbucketserver/creating-ssh-keys-776639788.html).    
    –ù—É–∂–µ–Ω –∫–ª—é—á –±–µ–∑ –ø–∞—Ä–æ–ª—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–∑ mirakle (Gradle) –µ–≥–æ –Ω–µ–∫—É–¥–∞ –≤–≤–æ–¥–∏—Ç—å.
    - –î–æ–±–∞–≤—å —Å–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π ssh –∫–ª—é—á - [–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (internal)](http://links.k.avito.ru/QP)
        - –°–æ–∑–¥–∞–π PR –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        - –ü–æ–ø—Ä–æ—Å–∏ –≤ —á–∞—Ç–∏–∫–µ [#devops](https://avito.slack.com/archives/C02D4DCQ2) –≤–ª–∏—Ç—å –µ–≥–æ
    - –ó–∞–ø—Ä–æ—Å–∏ –≤ [Service Desk (internal)](http://links.k.avito.ru/uZ) –¥–æ—Å—Ç—É–ø –ø–æ ssh –Ω–∞ host android-builder
- –í–∫–ª—é—á–∏ mirakle: 

```sh
./mirakle.py --enable
```

`username` –±—É–¥–µ—Ç –≤–∑—è—Ç –∏–∑ `git user.email`

- –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É, –∑–∞–ø—É—Å—Ç–∏ –ª—é–±—É—é –∑–∞–¥–∞—á—É: `./gradlew help`   
–í –ª–æ–≥–µ –±—É–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:

```text
Here's Mirakle ...

:uploadToRemote

:executeOnRemote

:downloadInParallel
```

–í —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑—ã –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á–∞—Ç—å `./mirakle.py --enable`

## –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å?

```sh
./mirakle.py --disable
```

–ß—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–±–æ—Ä–∫–∏, –¥–æ–±–∞–≤—å –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã Gradle `-x mirakle`   

–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫: 

```sh
/mirakle.py --wipe
```

## Troubleshooting

- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω VPN
- –ü—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å mirakle –ø–æ ssh, –ø–æ–¥–∫–ª—é—á–∏—Å—å –≤—Ä—É—á–Ω—É—é:

```sh
ssh [<username>@]<mirakle host>
``` 

- –ü—Ä–æ–≤–µ—Ä—å [known issues]({{<relref "#known-issues">}})

## Known issues

### –ó–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –Ω–µ —Ç–æ, —á—Ç–æ —è –∑–∞–ø—É—Å–∫–∞–ª

–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.

### –°–±–æ—Ä–∫–∞ –≤ mirakle –∏–¥–µ—Ç –¥–æ–ª—å—à–µ —á–µ–º –ª–æ–∫–∞–ª—å–Ω–∞—è

- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –¥—Ä—É–≥—É—é –º–∞—à–∏–Ω—É –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è. –ï—Å–ª–∏ —Å–æ–±–∏—Ä–∞–µ—à—å —á—Ç–æ-—Ç–æ –Ω–µ–±–æ–ª—å—à–æ–µ, —Ç–æ —Å—Ä–∞–≤–Ω–∏ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–æ–π. –û–Ω–∞ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ. 
- –ù–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ –Ω–∞–∫–æ–ø–∏–ª–∏—Å—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ, rsync –∏—Ö –Ω–µ —É–¥–∞–ª–∏–ª.   
–£–¥–∞–ª–∏ –∏—Ö: 

```sh
./clean.py --remote
```
